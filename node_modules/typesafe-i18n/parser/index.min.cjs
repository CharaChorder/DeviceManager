"use strict";var l=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var D=(r,t)=>{for(var e in t)l(r,e,{get:t[e],enumerable:!0})},M=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of b(t))!F.call(r,o)&&o!==e&&l(r,o,{get:()=>t[o],enumerable:!(s=w(t,o))||s.enumerable});return r};var j=r=>M(l({},"__esModule",{value:!0}),r);var Q={};D(Q,{experimentalParseMessage:()=>h,experimentalSerializeMessage:()=>A});module.exports=j(Q);var p=r=>r!==void 0;var m=r=>typeof r=="string";var u=r=>t=>t[r];var f=r=>Array.from(new Set(r));var O=r=>Object.fromEntries(Object.entries(r).map(([t,e])=>t!=="i"&&e&&e!="0"&&[t,e]).filter(Boolean)),z=r=>Object.fromEntries(Object.keys(r).map(t=>{let e=r[t];return[t,Array.isArray(e)?e.map(s=>s?.trim()):e===!!e?e:e?.trim()]})),U=r=>{let[t="",...e]=r.split("|"),[s="",o]=t.split(":"),[a,n]=s.split("?");return{k:a,i:o,n:n==="",f:e}},g=r=>!!(r.o||r.r),$=(r,t)=>{let[e,s]=r.split(":");s||(s=e,e=t);let o=s.split("|"),[a,n,i,P,B,k]=o,c=o.filter(v=>v!==void 0).length;return c===1?{k:e,r:a}:c===2?{k:e,o:a,r:n}:c===3?{k:e,z:a,o:n,r:i}:{k:e,z:a,o:n,t:i,f:P,m:B,r:k}},T=/^\{.*\}$/,N=r=>Object.fromEntries(y(r).split(",").map(t=>t.split(":")).reduce((t,e)=>e.length===2?[...t,e.map(s=>s.trim())]:(t[t.length-1][1]+=","+e[0],t),[])),d=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,y=r=>r.substring(1,r.length-1),S=(r,t=!0,e="",s="")=>r.split(d).map(o=>{if(!o.match(d))return o;let a=y(o);if(a.startsWith("{"))return $(y(a),s);let n=U(a);return s=n.k||s,!e&&(e=s),n}).map(o=>{if(typeof o=="string")return o;o.k||(o.k=e||"0");let a=z(o);return t?O(a):a});var E=r=>r.kind==="text",x=r=>r.kind==="plural",C=r=>r.kind==="parameter";var Z=r=>r.kind==="switch-case",h=r=>X(S(r,!1).map(R).filter(p)),R=r=>m(r)?r?_(r):void 0:g(r)?I(r):W(r),_=r=>({kind:"text",content:r}),I=({k:r,z:t,o:e,t:s,f:o,m:a,r:n})=>({kind:"plural",key:r,...t?{zero:t}:void 0,...e?{one:e}:void 0,...s?{two:s}:void 0,...o?{few:o}:void 0,...a?{many:a}:void 0,other:n}),W=({k:r,i:t,n:e,f:s})=>({kind:"parameter",key:r,types:t?[t]:[],optional:e||!1,transforms:(s||[]).map(G)}),G=r=>r.match(T)?{kind:"switch-case",cases:Object.entries(N(r)).map(([e,s])=>({key:e,value:s})),raw:r}:{kind:"formatter",name:r},X=r=>{let t=r.filter(C),e=r.filter(x),s={};return t.forEach(({key:o,types:a,transforms:n,optional:i})=>{let P=a.length?a:q(n);s[o]={types:f([...s[o]?.types||[],...P]).filter(p),optional:s[o]?.optional||i}}),e.forEach(({key:o})=>{s[o]?.types.length||(s[o]={types:["string","number","boolean"],optional:!1})}),Object.keys(s).forEach(o=>{s[o]?.types.length||(s[o]={types:["unknown"],optional:s[o]?.optional||!1})}),Object.entries(s).forEach(([o,a])=>{let n=t.find(i=>i.key===o);n&&(n.types=a.types,n.optional=n.optional||a.optional)}),r};var q=r=>{if(!r?.length)return[];let t=r[0];return Z(t)?t.cases.map(u("key")).map(s=>s==="*"?"string":`'${s}'`):[]};var A=r=>r.map(L).join("");var L=r=>E(r)?r.content:x(r)?H(r):V(r),H=({zero:r,one:t,two:e,few:s,many:o,other:a})=>`{{${[r,t,e,s,o,a].filter(n=>n!==void 0).join("|")}}}`,V=({key:r,optional:t,types:e,transforms:s})=>{let o=e.length===1?e[0]==="unknown"?void 0:e[0]:void 0;return`{${r}${o?`:${o}`:""}${t?"?":""}${s.length?`|${s.map(J).join("|")}`:""}}`},J=r=>r.kind==="formatter"?r.name:r.raw||K(r),K=r=>`{${r.cases.map(({key:t,value:e})=>`${t}:${e}`).join(",")}}`;
