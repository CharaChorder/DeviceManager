var p=r=>r!==void 0;var l=r=>typeof r=="string";var m=r=>s=>s[r];var u=r=>Array.from(new Set(r));var B=r=>Object.fromEntries(Object.entries(r).map(([s,e])=>s!=="i"&&e&&e!="0"&&[s,e]).filter(Boolean)),k=r=>Object.fromEntries(Object.keys(r).map(s=>{let e=r[s];return[s,Array.isArray(e)?e.map(t=>t?.trim()):e===!!e?e:e?.trim()]})),v=r=>{let[s="",...e]=r.split("|"),[t="",o]=s.split(":"),[a,n]=t.split("?");return{k:a,i:o,n:n==="",f:e}},d=r=>!!(r.o||r.r),w=(r,s)=>{let[e,t]=r.split(":");t||(t=e,e=s);let o=t.split("|"),[a,n,i,P,C,h]=o,c=o.filter(A=>A!==void 0).length;return c===1?{k:e,r:a}:c===2?{k:e,o:a,r:n}:c===3?{k:e,z:a,o:n,r:i}:{k:e,z:a,o:n,t:i,f:P,m:C,r:h}},g=/^\{.*\}$/,T=r=>Object.fromEntries(f(r).split(",").map(s=>s.split(":")).reduce((s,e)=>e.length===2?[...s,e.map(t=>t.trim())]:(s[s.length-1][1]+=","+e[0],s),[])),x=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,f=r=>r.substring(1,r.length-1),N=(r,s=!0,e="",t="")=>r.split(x).map(o=>{if(!o.match(x))return o;let a=f(o);if(a.startsWith("{"))return w(f(a),t);let n=v(a);return t=n.k||t,!e&&(e=t),n}).map(o=>{if(typeof o=="string")return o;o.k||(o.k=e||"0");let a=k(o);return s?B(a):a});var S=r=>r.kind==="text",y=r=>r.kind==="plural",E=r=>r.kind==="parameter";var b=r=>r.kind==="switch-case",F=r=>U(N(r,!1).map(D).filter(p)),D=r=>l(r)?r?M(r):void 0:d(r)?j(r):O(r),M=r=>({kind:"text",content:r}),j=({k:r,z:s,o:e,t,f:o,m:a,r:n})=>({kind:"plural",key:r,...s?{zero:s}:void 0,...e?{one:e}:void 0,...t?{two:t}:void 0,...o?{few:o}:void 0,...a?{many:a}:void 0,other:n}),O=({k:r,i:s,n:e,f:t})=>({kind:"parameter",key:r,types:s?[s]:[],optional:e||!1,transforms:(t||[]).map(z)}),z=r=>r.match(g)?{kind:"switch-case",cases:Object.entries(T(r)).map(([e,t])=>({key:e,value:t})),raw:r}:{kind:"formatter",name:r},U=r=>{let s=r.filter(E),e=r.filter(y),t={};return s.forEach(({key:o,types:a,transforms:n,optional:i})=>{let P=a.length?a:$(n);t[o]={types:u([...t[o]?.types||[],...P]).filter(p),optional:t[o]?.optional||i}}),e.forEach(({key:o})=>{t[o]?.types.length||(t[o]={types:["string","number","boolean"],optional:!1})}),Object.keys(t).forEach(o=>{t[o]?.types.length||(t[o]={types:["unknown"],optional:t[o]?.optional||!1})}),Object.entries(t).forEach(([o,a])=>{let n=s.find(i=>i.key===o);n&&(n.types=a.types,n.optional=n.optional||a.optional)}),r};var $=r=>{if(!r?.length)return[];let s=r[0];return b(s)?s.cases.map(m("key")).map(t=>t==="*"?"string":`'${t}'`):[]};var Z=r=>r.map(R).join("");var R=r=>S(r)?r.content:y(r)?_(r):I(r),_=({zero:r,one:s,two:e,few:t,many:o,other:a})=>`{{${[r,s,e,t,o,a].filter(n=>n!==void 0).join("|")}}}`,I=({key:r,optional:s,types:e,transforms:t})=>{let o=e.length===1?e[0]==="unknown"?void 0:e[0]:void 0;return`{${r}${o?`:${o}`:""}${s?"?":""}${t.length?`|${t.map(W).join("|")}`:""}}`},W=r=>r.kind==="formatter"?r.name:r.raw||G(r),G=r=>`{${r.cases.map(({key:s,value:e})=>`${s}:${e}`).join(",")}}`;export{F as experimentalParseMessage,Z as experimentalSerializeMessage};
